{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\r\n * Frontend React Hook and Types for @nikhilayeturi23/rltool\r\n *\r\n * This module provides the React hook for RL-based optimization UI state management.\r\n * Use this in your React components and frontend code.\r\n *\r\n * @module @nikhilayeturi23/rltool\r\n *\r\n * @example\r\n * ```typescript\r\n * // Import in React components\r\n * import { useRLTool, type RLOptimizationResult } from '@nikhilayeturi23/rltool';\r\n * ```\r\n *\r\n * @remarks\r\n * This module exports frontend-optimized types. For backend optimization,\r\n * import from '@nikhilayeturi23/rltool/backend' instead.\r\n */\r\n\r\nimport { useState, useCallback } from \"react\";\r\n\r\n/**\r\n * Generic progress log for RL iterations\r\n */\r\nexport interface RLProgressLog {\r\n  iteration: number;\r\n  action: string;\r\n  passed: boolean;\r\n  reward: number;\r\n  output: any;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * Generic RL optimization result\r\n */\r\nexport interface RLOptimizationResult<T = any> {\r\n  output: T;\r\n  metadata: {\r\n    iterations: number;\r\n    finalReward: number;\r\n    iterationLogs: any[];\r\n  };\r\n  message: string;\r\n}\r\n\r\n/**\r\n * Options for the RL Tool hook\r\n */\r\nexport interface RLToolOptions {\r\n  /** API endpoint to use for optimization */\r\n  apiEndpoint: string;\r\n\r\n  /** Callback fired on each iteration/progress update */\r\n  onProgress?: (log: RLProgressLog) => void;\r\n\r\n  /** Callback fired when optimization completes */\r\n  onComplete?: (result: RLOptimizationResult) => void;\r\n\r\n  /** Callback fired on error */\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\n/**\r\n * Generic input for optimization\r\n */\r\nexport interface OptimizationInput {\r\n  /** The objective to optimize for */\r\n  objective: any;\r\n\r\n  /** Any domain-specific parameters */\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * RL Tool Hook - Single Standalone React Hook\r\n *\r\n * A React hook that provides RL-based optimization for any domain.\r\n * Completely decoupled from SQL or any specific use case.\r\n *\r\n * @example\r\n * ```tsx\r\n * import { useRLTool } from '@nikhilayeturi23/rltool';\r\n *\r\n * function MyComponent() {\r\n *   const { optimize, loading, result, error } = useRLTool({\r\n *     apiEndpoint: \"/api/optimize-anything\"\r\n *   });\r\n *\r\n *   const handleClick = async () => {\r\n *     await optimize({\r\n *       objective: {\r\n *         input: \"What to optimize\",\r\n *         constraints: { budget: 1000 }\r\n *       }\r\n *     });\r\n *   };\r\n *\r\n *   return (\r\n *     <button onClick={handleClick} disabled={loading}>\r\n *       {loading ? \"Optimizing...\" : \"Optimize\"}\r\n *     </button>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useRLTool(options: RLToolOptions) {\r\n  const {\r\n    onProgress,\r\n    onComplete,\r\n    onError,\r\n    apiEndpoint,\r\n  } = options;\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [result, setResult] = useState<RLOptimizationResult | null>(null);\r\n  const [error, setError] = useState<Error | null>(null);\r\n  const [progress, setProgress] = useState<RLProgressLog[]>([]);\r\n\r\n  /**\r\n   * Optimize based on the given input\r\n   */\r\n  const optimize = useCallback(\r\n    async (input: OptimizationInput): Promise<RLOptimizationResult> => {\r\n      setLoading(true);\r\n      setError(null);\r\n      setProgress([]);\r\n\r\n      try {\r\n        const response = await fetch(apiEndpoint, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(input),\r\n        });\r\n\r\n        if (!response.ok) {\r\n          const errorData = await response.json() as { error?: string };\r\n          throw new Error(errorData.error || \"Optimization failed\");\r\n        }\r\n\r\n        const data = await response.json() as RLOptimizationResult;\r\n\r\n        // Process iteration logs and fire progress callbacks\r\n        if (data.metadata?.iterationLogs) {\r\n          const logs: RLProgressLog[] = data.metadata.iterationLogs.map(\r\n            (log: any) => ({\r\n              iteration: log.iteration,\r\n              action: log.action,\r\n              passed: log.evaluation?.passed || false,\r\n              reward: log.reward?.total || 0,\r\n              output: log.output || log.sql,\r\n              timestamp: Date.now(),\r\n            })\r\n          );\r\n\r\n          setProgress(logs);\r\n\r\n          // Fire onProgress for each iteration\r\n          if (onProgress) {\r\n            logs.forEach((log) => onProgress(log));\r\n          }\r\n        }\r\n\r\n        setResult(data);\r\n\r\n        // Fire completion callback\r\n        if (onComplete) {\r\n          onComplete(data);\r\n        }\r\n\r\n        return data;\r\n      } catch (err: any) {\r\n        const error = err instanceof Error ? err : new Error(String(err));\r\n        setError(error);\r\n\r\n        // Fire error callback\r\n        if (onError) {\r\n          onError(error);\r\n        }\r\n\r\n        throw error;\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    [apiEndpoint, onProgress, onComplete, onError]\r\n  );\r\n\r\n  /**\r\n   * Reset the hook state\r\n   */\r\n  const reset = useCallback(() => {\r\n    setLoading(false);\r\n    setResult(null);\r\n    setError(null);\r\n    setProgress([]);\r\n  }, []);\r\n\r\n  return {\r\n    /** Function to trigger optimization */\r\n    optimize,\r\n\r\n    /** Whether optimization is in progress */\r\n    loading,\r\n\r\n    /** The optimization result (null until complete) */\r\n    result,\r\n\r\n    /** Error if optimization failed */\r\n    error,\r\n\r\n    /** Array of progress logs from RL iterations */\r\n    progress,\r\n\r\n    /** Reset the hook state */\r\n    reset,\r\n  };\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBA,mBAAsC;AAuF/B,SAAS,UAAU,SAAwB;AAChD,QAAM;AAAA,IACJ;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,IAAI;AAEJ,QAAM,CAAC,SAAS,UAAU,QAAI,uBAAS,KAAK;AAC5C,QAAM,CAAC,QAAQ,SAAS,QAAI,uBAAsC,IAAI;AACtE,QAAM,CAAC,OAAO,QAAQ,QAAI,uBAAuB,IAAI;AACrD,QAAM,CAAC,UAAU,WAAW,QAAI,uBAA0B,CAAC,CAAC;AAK5D,QAAM,eAAW;AAAA,IACf,OAAO,UAA4D;AACjE,iBAAW,IAAI;AACf,eAAS,IAAI;AACb,kBAAY,CAAC,CAAC;AAEd,UAAI;AACF,cAAM,WAAW,MAAM,MAAM,aAAa;AAAA,UACxC,QAAQ;AAAA,UACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,UAC9C,MAAM,KAAK,UAAU,KAAK;AAAA,QAC5B,CAAC;AAED,YAAI,CAAC,SAAS,IAAI;AAChB,gBAAM,YAAY,MAAM,SAAS,KAAK;AACtC,gBAAM,IAAI,MAAM,UAAU,SAAS,qBAAqB;AAAA,QAC1D;AAEA,cAAM,OAAO,MAAM,SAAS,KAAK;AAGjC,YAAI,KAAK,UAAU,eAAe;AAChC,gBAAM,OAAwB,KAAK,SAAS,cAAc;AAAA,YACxD,CAAC,SAAc;AAAA,cACb,WAAW,IAAI;AAAA,cACf,QAAQ,IAAI;AAAA,cACZ,QAAQ,IAAI,YAAY,UAAU;AAAA,cAClC,QAAQ,IAAI,QAAQ,SAAS;AAAA,cAC7B,QAAQ,IAAI,UAAU,IAAI;AAAA,cAC1B,WAAW,KAAK,IAAI;AAAA,YACtB;AAAA,UACF;AAEA,sBAAY,IAAI;AAGhB,cAAI,YAAY;AACd,iBAAK,QAAQ,CAAC,QAAQ,WAAW,GAAG,CAAC;AAAA,UACvC;AAAA,QACF;AAEA,kBAAU,IAAI;AAGd,YAAI,YAAY;AACd,qBAAW,IAAI;AAAA,QACjB;AAEA,eAAO;AAAA,MACT,SAAS,KAAU;AACjB,cAAMA,SAAQ,eAAe,QAAQ,MAAM,IAAI,MAAM,OAAO,GAAG,CAAC;AAChE,iBAASA,MAAK;AAGd,YAAI,SAAS;AACX,kBAAQA,MAAK;AAAA,QACf;AAEA,cAAMA;AAAA,MACR,UAAE;AACA,mBAAW,KAAK;AAAA,MAClB;AAAA,IACF;AAAA,IACA,CAAC,aAAa,YAAY,YAAY,OAAO;AAAA,EAC/C;AAKA,QAAM,YAAQ,0BAAY,MAAM;AAC9B,eAAW,KAAK;AAChB,cAAU,IAAI;AACd,aAAS,IAAI;AACb,gBAAY,CAAC,CAAC;AAAA,EAChB,GAAG,CAAC,CAAC;AAEL,SAAO;AAAA;AAAA,IAEL;AAAA;AAAA,IAGA;AAAA;AAAA,IAGA;AAAA;AAAA,IAGA;AAAA;AAAA,IAGA;AAAA;AAAA,IAGA;AAAA,EACF;AACF;","names":["error"]}